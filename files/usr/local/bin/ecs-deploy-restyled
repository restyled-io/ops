#!/bin/sh
set -eu

: "${RESTYLED_CLUSTER:=restyled-prod}"
: "${RESTYLED_DEPLOY_TIMEOUT:=900}"

echo "Deploying webhooks service..."
ecs deploy "$RESTYLED_CLUSTER" webhooks \
  --region us-east-1 --no-deregister --rollback \
  --timeout "$RESTYLED_DEPLOY_TIMEOUT" \
  "$@"

for cmd in health sync-marketplace reconcile; do
  echo "Deploying $cmd scheduled task..."
  ecs cron "$RESTYLED_CLUSTER" "restyled-prod-$cmd" "$cmd" \
    --region us-east-1 --no-deregister --rollback "$@"
done
