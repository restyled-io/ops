#!/usr/bin/env bash
set -eu

q=$1
shift

repo_id=$(
  restyled-api "/admin/repos/search?q=$q" |
    jq -r '.repos | .[] | select((.owner + "/" + .name) == "'"$q"'") | .id' |
    head -n 1
)

if [ -z "$repo_id" ]; then
  echo "$q returned no results" >&2
  exit 1
fi

jo "$@" | restyled-api "/admin/repos/$repo_id" -X PATCH -d @- | jq
